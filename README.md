# ClipPilot

<p align="center">
  <img src="https://img.shields.io/badge/macOS-13.0+-blue.svg" alt="macOS 13.0+">
  <img src="https://img.shields.io/badge/Swift-5.9+-orange.svg" alt="Swift 5.9+">
  <img src="https://img.shields.io/badge/Xcode-15.0+-blue.svg" alt="Xcode 15.0+">
  <img src="https://img.shields.io/badge/version-1.0.3-green.svg" alt="Version 1.0.3">
  <img src="https://img.shields.io/badge/license-MIT-green.svg" alt="License">
</p>

macOS用の強力なネイティブクリップボードマネージャー。クリップボード履歴の追跡、検索、再利用を簡単に行えます。

## 機能

### コア機能

- 📋 **自動クリップボード監視** - リアルタイムで全てのクリップボード変更を記録
- 🔍 **強力な検索** - 全文検索でクリップボードアイテムを素早く検索
- 🎯 **スマートフィルタリング** - タイプ別フィルタ（テキスト、RTF、画像）
- ⭐ **お気に入り機能** - よく使うアイテムをピン留め
- 🎨 **リッチコンテンツ対応** - テキスト、リッチテキスト（RTF）、サムネイル付き画像
- ⚡ **グローバルホットキー**
  - ⌥⌘V - クリップボード履歴を表示
  - ⌥⌘F - お気に入りを表示
  - ⌘1-9 - アイテムを素早く選択
- 🍎 **メニューバー統合** - NSPopover UIで快適なアクセス

### UI/UX

- 🎨 **美しいアイコン** - クリップボードをモチーフにした統一感のあるデザイン
- 📦 **視覚的なDMGインストーラ** - ドラッグ&ドロップでインストール
- 💫 **透明度対応** - 洗練された半透明UI（95%不透明度）
- 🔄 **タブインターフェース** - 履歴とお気に入りを切り替え

### プライバシーとセキュリティ

- 🔒 **アプリ除外機能** - パスワードマネージャーや機密アプリを監視から除外
- 🛡️ **アクセシビリティ権限** - 透明性のある権限処理とセットアップガイド
- 📝 **プライバシー第一** - 全データはローカル保存、デフォルトでクラウド同期なし

### カスタマイズ

- ⚙️ **設定可能な制限** - 最大アイテム数（デフォルト500）、保持日数（デフォルト30日）
- 📏 **サイズ制限** - 最大テキスト長と画像サイズを設定可能
- 🚀 **ログイン時起動** - macOS起動時に自動起動
- 🌐 **国際化対応** - 日本語と英語のローカライズ

### パフォーマンス

- 💾 **効率的なストレージ** - Core Dataによる自動クリーンアップ
- 🖼️ **画像最適化** - 高速プレビュー用サムネイル生成
- ⚡ **省エネルギー設計** - Energy Managerによる効率的なクリップボード監視
- 🧹 **スマートクリーンアップ** - 設定に基づいた古いアイテムの自動削除
- 🔄 **重複検出** - 重複エントリの防止

## 必要環境

- macOS 13.0以降
- アクセシビリティ権限（ペースト機能用）

## インストール

### DMGからインストール（推奨）

1. **DMGファイルをダウンロード**

   [最新リリース](https://github.com/YOUR_USERNAME/clipPilot/releases)からClipPilot-x.x.x.dmgをダウンロード

2. **DMGを開く**

   ダウンロードしたDMGファイルをダブルクリック

3. **アプリをインストール**

   ClipPilot.appをApplicationsフォルダにドラッグ&ドロップ

4. **アプリを起動**

   - Applicationsフォルダから起動、またはLaunchpadから起動
   - 初回起動時に「開発元を確認できません」と表示された場合：
     - アプリを**右クリック** → 「開く」を選択
     - または、システム設定 → プライバシーとセキュリティ → 「このまま開く」をクリック

5. **アクセシビリティ権限を許可**（下記参照）

### ソースからビルド

<details>
<summary>クリックして展開</summary>

1. **リポジトリをクローン**

   ```bash
   git clone <repository-url>
   cd clipPilot
   ```

2. **ビルドスクリプトを使用**

   ```bash
   ./scripts/build-dmg.sh 1.0.3
   ```

   または、Swift Package Managerを直接使用：

   ```bash
   cd ClipPilot
   swift build -c release
   ```

3. **Xcodeで開く**

   ```bash
   cd ClipPilot
   open Package.swift
   ```

詳細は[BUILDING.md](BUILDING.md)を参照してください。

</details>

### 初回起動セットアップ

ClipPilotを初めて起動する際、権限の付与が必要です：

1. **アクセシビリティ権限**

   - ClipPilotがアクセシビリティアクセスの許可を求めます
   - 「設定を開く」をクリックしてシステム環境設定へ
   - **セキュリティとプライバシー → プライバシー → アクセシビリティ** に移動
   - 鍵アイコンをクリックして変更を許可
   - リストから「ClipPilot」を見つけてチェックボックスにチェック
   - ClipPilotがリストにない場合は、「+」をクリックして手動で追加

2. **インストールの確認**

   - メニューバーにクリップボードアイコンが表示されます
   - ⌥⌘V を押してポップアップウィンドウを開く
   - テキストをコピーしてクリップボード監視が機能していることを確認

## 使い方

### グローバルホットキー

- **⌥⌘V** - クリップボード履歴を表示
- **⌥⌘F** - お気に入りを表示
- **ESC** - ポップアップを閉じる

### メニューバー

メニューバーのクリップボードアイコンをクリックすると、NSPopoverでクリップボード履歴が表示されます。

### ポップアップウィンドウ

ポップアップウィンドウの機能：

- **タブ切り替え** - 履歴とお気に入りを切り替え
- **検索バー** - クリップボード履歴を検索
- **フィルタボタン** - お気に入り、すべて、テキスト、RTF、画像でフィルタリング
- **アイテムリスト** - 最新順にソート（ピン留めアイテムが最初に表示）
- **キーボードショートカット** - ⌘1-9 で上位9アイテムを素早く選択
- **コンテキストメニュー** - アイテムを右クリックでオプション表示：
  - ペースト - アクティブなアプリケーションにペースト
  - クリップボードにコピー - ペーストせずにコピー
  - ピン留め/ピン解除 - お気に入りとして固定
  - 削除 - 履歴から削除

### キーボードショートカット

| ショートカット | 機能 |
|--------------|------|
| ⌥⌘V | クリップボード履歴を表示 |
| ⌥⌘F | お気に入りを表示 |
| ⌘1-9 | 上位9アイテムを選択してペースト |
| ESC | ポップアップを閉じる |

## 配布用ビルド

### DMGパッケージの作成

プロジェクトには自動DMG作成スクリプトが含まれています：

```bash
./scripts/build-dmg.sh 1.0.3
```

このスクリプトは以下を実行します：

1. リリースビルドを作成
2. .appバンドルを生成
3. アプリにコード署名（アドホック署名）
4. アイコンと背景画像を含むDMGを作成
5. DMGウィンドウのレイアウトを設定

生成されたDMGファイル：`ClipPilot-1.0.3.dmg`

### アイコンとDMG背景の作成

```bash
./scripts/create-icons.sh
```

このスクリプトは以下を生成します：

- **AppIcon.icns** - すべてのサイズのアプリケーションアイコン
- **background.png** - インストール用の矢印付きDMG背景画像

## アーキテクチャ

### プロジェクト構造

```
ClipPilot/
├── Sources/
│   ├── App/
│   │   ├── ClipPilotApp.swift      # SwiftUIアプリエントリーポイント
│   │   └── AppDelegate.swift        # AppKitライフサイクル管理
│   ├── Core/
│   │   ├── ClipboardMonitor.swift   # クリップボード監視
│   │   ├── EnergyManager.swift      # 省エネルギー管理
│   │   ├── GlobalHotkeyManager.swift # グローバルホットキー
│   │   └── PasteService.swift       # ペーストシミュレーション
│   ├── Models/
│   │   ├── ClipboardItem.swift      # Core Dataエンティティ
│   │   └── HistoryStore.swift       # データ管理
│   ├── Views/
│   │   ├── MainPopupView.swift      # メインUI（タブ切り替え）
│   │   ├── PopupWindow.swift        # ウィンドウコンテナ
│   │   ├── PopupSearchView.swift    # 履歴検索ビュー
│   │   ├── FavoritesView.swift      # お気に入りビュー
│   │   ├── HistoryItemRow.swift     # アイテム行
│   │   ├── MenuBarController.swift  # メニューバー管理
│   │   └── SettingsView.swift       # 設定UI
│   ├── Utilities/
│   │   ├── Constants.swift          # アプリ定数
│   │   ├── Logger.swift             # ログ管理
│   │   └── Preferences.swift        # 設定管理
│   └── Resources/
│       ├── AppIcon.icns            # アプリアイコン
│       ├── en.lproj/               # 英語ローカライズ
│       └── ja.lproj/               # 日本語ローカライズ
├── scripts/
│   ├── build-dmg.sh                # DMG作成スクリプト
│   └── create-icons.sh             # アイコン生成スクリプト
├── dmg-resources/
│   └── background.png              # DMG背景画像
└── Package.swift
```

### 主要コンポーネント

**ClipboardMonitor**
- `NSPasteboard.general` をポーリング
- `changeCount` で変更を検出
- Energy Manager連携で省エネルギー動作
- 除外アプリケーションをフィルタリング

**HistoryStore**
- Core Data永続化
- 自動重複検出
- 検索とフィルタリング
- お気に入り管理

**EnergyManager**
- バッテリー状態監視
- 電源状態に応じたポーリング間隔調整
- プロセッサー効率コア対応

**GlobalHotkeyManager**
- Carbon Event Managerでグローバルホットキー
- ⌥⌘V（履歴）と⌥⌘F（お気に入り）をサポート

**PasteService**
- CGEvent APIでキーボードシミュレーション
- 一時的なクリップボード操作

## プライバシーポリシー

ClipPilotはあなたのプライバシーを尊重します：

- **ローカルストレージのみ** - 全てのクリップボードデータはMacにローカル保存
- **ネットワークアクセスなし** - インターネットに接続せず、外部へデータを送信しません
- **除外アプリ** - 監視から除外するアプリを設定可能
- **ユーザーコントロール** - いつでも履歴をクリア、アイテムをピン留め可能
- **透明性** - オープンソースコード

### 推奨される除外設定

以下を除外することを推奨します：

- パスワードマネージャー（1Password、LastPass、Bitwardenなど）
- 銀行アプリケーション
- 機密情報を扱う全てのアプリ

## 既知の制限事項

1. **アクセシビリティ要件**
   - ペースト機能にアクセシビリティ権限が必要

2. **ペーストメカニズム**
   - CGEventシミュレーションに依存
   - 一部のアプリでは動作しない可能性
   - 代替手段：「クリップボードにコピー」を使用

3. **RTFの制限**
   - RTFコンテンツは表示用にプレーンテキストに変換
   - ペースト時は完全なフォーマットを保持

4. **大きな画像**
   - デフォルト制限：5MB（設定可能）

## トラブルシューティング

### アプリがLaunchpadに表示されない

Launchpadのデータベースをリセット：

```bash
defaults write com.apple.dock ResetLaunchPad -bool true
killall Dock
```

### ペーストが機能しない

1. アクセシビリティ権限が付与されているか確認
2. システム設定でClipPilotを削除して再追加
3. ClipPilotを再起動

### ホットキーが機能しない

1. ⌥⌘V を使用している他のアプリとの競合を確認
2. メニューバーアイコンをクリックして手動で開いてみる

## 開発

### 前提条件

- Xcode 15.0以降
- Swift 5.9以降
- macOS 13.0以降

### ビルド

```bash
# リリースビルド
swift build -c release

# DMGパッケージ作成
./scripts/build-dmg.sh 1.0.3
```

詳細は[BUILDING.md](BUILDING.md)を参照してください。

## 変更履歴

### v1.0.3 (最新)
- ✅ アプリアイコン追加（クリップボード+書類デザイン）
- ✅ DMG背景画像追加（ドラッグ&ドロップガイド付き）
- ✅ NSPopover背景色の統一（透明度95%）
- ✅ LSUIElementをfalseに変更してLaunchpad表示に対応
- ✅ コード署名とhardened runtime対応
- ✅ ソースコード整理（未使用コード削除）

### v1.0.2
- ✅ DMGインストーラの視覚的改善
- ✅ アイコンレイアウトの最適化

### v1.0.1
- ✅ コード署名追加

### v1.0.0
- 🎉 初回リリース

## ライセンス

MITライセンス - 詳細はLICENSEファイルを参照

## サポート

問題、質問、提案については：

- GitHubでissueを作成
- [トラブルシューティング](#トラブルシューティング)セクションを確認

## ロードマップ

将来の機能拡張：

- [ ] iCloud同期（オプション）
- [ ] 正規表現ベースのテキスト変換
- [ ] スニペット管理
- [ ] 画像のOCR（Visionフレームワーク）
- [ ] UIでカスタマイズ可能なホットキー
- [ ] 履歴のインポート/エクスポート
- [ ] 暗号化ストレージオプション

---

**macOSの生産性向上のために❤️を込めて作成**
