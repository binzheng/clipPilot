# ClipPilot - プロジェクトサマリー

## バージョン 1.0.3

## 📦 プロジェクト完成！

必要な全ての機能を備えた完全に機能するmacOSクリップボードマネージャーの実装が完了しました。プロフェッショナルなアイコン、DMGインストーラー、透明感のあるモダンなUIを備えています。

## ✅ 完成した機能

### コア機能
- ✅ メニューバーアプリケーション（ステータスバーアイコン）
- ✅ 300msポーリングによるクリップボード監視
- ✅ グローバルホットキー（⌥⌘V）によるポップアップウィンドウ
- ✅ テキスト、RTF、画像のサポート
- ✅ 自動クリーンアップ機能付きCore Data永続化
- ✅ 重複検出と統合
- ✅ ピン留め/ピン解除機能
- ✅ タイプ別検索とフィルタリング

### ユーザーインターフェース
- ✅ フィルタリング機能付きポップアップ検索ウィンドウ
- ✅ 最近のアイテム表示付きメニューバー統合
- ✅ 履歴とお気に入りのタブ切り替え
- ✅ 透明感のあるNSPopover（95%不透明度）
- ✅ 統一された背景色デザイン
- ✅ プロフェッショナルなアプリアイコン
- ✅ 4つのタブを持つ設定ウィンドウ
- ✅ クリップボードアイテム用コンテキストメニュー
- ✅ ピン留めアイテムの視覚的フィードバック
- ✅ Launchpadサポート

### 設定
- ✅ 最大履歴アイテム数（デフォルト500）
- ✅ 最大履歴保持日数（デフォルト30日）
- ✅ 最大テキスト長（デフォルト10,000文字）
- ✅ 最大画像サイズ（デフォルト5MB）
- ✅ アプリ除外リスト管理
- ✅ ログイン時起動サポート

### プライバシーとセキュリティ
- ✅ アクセシビリティ権限処理
- ✅ 初回起動時の権限ダイアログ
- ✅ 除外アプリサポート（パスワードマネージャー）
- ✅ ローカルストレージのみ（クラウド同期なし）

### ローカライズ
- ✅ 日本語（ja）ローカライズ
- ✅ 英語（en）ローカライズ
- ✅ 全UI文字列のローカライズ

### テスト
- ✅ 包括的なユニットテスト
- ✅ パフォーマンスベンチマーク
- ✅ 全テストが合格

### 配布とパッケージング
- ✅ 自動DMGビルドスクリプト
- ✅ アイコン生成スクリプト（Pillow使用）
- ✅ カスタム背景画像付きDMGインストーラー
- ✅ Hardened Runtime付きコード署名
- ✅ エンタイトルメント設定
- ✅ GitHub Releases対応

### ドキュメント
- ✅ 詳細なREADME.md
- ✅ ビルドガイド（BUILDING.md）
- ✅ プロジェクトサマリー（PROJECT_SUMMARY.md）
- ✅ ライセンス（MIT）
- ✅ .gitignore設定

## 📁 プロジェクト構造

```
clipPilot/
├── README.md                    # メインドキュメント
├── BUILDING.md                  # ビルド手順
├── PROJECT_SUMMARY.md          # このファイル
├── LICENSE                      # MITライセンス
├── .gitignore                   # Git除外ルール
├── scripts/
│   ├── build-dmg.sh            # 自動DMGビルドスクリプト
│   └── create-icons.sh         # アイコン生成スクリプト
├── dmg-resources/
│   ├── background.png          # DMG背景画像
│   └── background@2x.png       # DMG背景画像（Retina）
└── ClipPilot/
    ├── Package.swift           # Swift Package Manager設定
    ├── Info.plist              # バンドル設定
    ├── entitlements.plist      # アプリ権限
    ├── Sources/
    │   ├── App/
    │   │   ├── ClipPilotApp.swift       # SwiftUIアプリエントリー
    │   │   └── AppDelegate.swift        # AppKitライフサイクル
    │   ├── Core/
    │   │   ├── ClipboardMonitor.swift   # クリップボードポーリング（300ms）
    │   │   ├── GlobalHotkeyManager.swift # Carbon hotkey API
    │   │   ├── PasteService.swift       # CGEventペーストシミュレーション
    │   │   ├── EnergyManager.swift      # バッテリー最適化
    │   │   └── AppLogger.swift          # ログシステム
    │   ├── Models/
    │   │   ├── ClipboardItem.swift      # Core Dataエンティティ
    │   │   └── HistoryStore.swift       # Core Data操作
    │   ├── Views/
    │   │   ├── PopupWindow.swift        # フローティングウィンドウ
    │   │   ├── MainPopupView.swift      # タブ付きメインビュー
    │   │   ├── PopupSearchView.swift    # 履歴検索UI
    │   │   ├── FavoritesView.swift      # お気に入りUI
    │   │   ├── HistoryItemRow.swift     # リストアイテムビュー
    │   │   ├── MenuBarController.swift  # ステータスバーメニュー
    │   │   └── SettingsView.swift       # 設定UI
    │   ├── Utilities/
    │   │   ├── Constants.swift          # アプリ定数
    │   │   └── Preferences.swift        # UserDefaultsラッパー
    │   └── Resources/
    │       ├── AppIcon.icns            # アプリアイコン
    │       ├── en.lproj/
    │       │   └── Localizable.strings  # 英語文字列
    │       └── ja.lproj/
    │           └── Localizable.strings  # 日本語文字列
    └── Tests/
        └── ClipPilotTests/
            └── ClipPilotTests.swift     # ユニットテスト（16テスト）
```

## 🚀 クイックスタート

### ビルド

```bash
cd ClipPilot
swift build
```

### 実行

```bash
swift run
```

### テスト

```bash
swift test
```

### Xcodeを使用

```bash
open Package.swift
```

⌘R で実行します。

## 🔑 必要な権限

### アクセシビリティ権限
**ペースト機能に必要**

1. システム環境設定 → セキュリティとプライバシー → プライバシー → アクセシビリティ を開く
2. 鍵アイコンをクリックして変更を許可
3. ClipPilotを追加して有効化

アプリは初回起動時に設定への直接リンクを表示します。

## 📝 主要な実装詳細

### クリップボード監視
- `NSPasteboard.general.changeCount`を使用して変更を検出
- 300msごとにポーリング（Constants.swiftで設定可能）
- 除外アプリケーションを自動フィルタリング
- 重複を検出して防止

### ストレージ
- プログラマティックモデル作成によるCore Data
- 以下に基づく自動クリーンアップ：
  - 最大アイテム数（デフォルト500）
  - 最大保持期間（デフォルト30日）
- ピン留めアイテムはクリーンアップから除外
- 画像の効率的なサムネイル生成

### ペーストメカニズム
- キーボードシミュレーション用CGEvent API
- 最前面のアプリケーションにCmd+Vを送信
- アクセシビリティ権限が必要
- フォールバック：手動ペースト用の「クリップボードにコピー」

### グローバルホットキー
- Carbon Event Manager統合
- ⌥⌘V（Option+Command+V）：履歴ポップアップを開く
- ⌥⌘F（Option+Command+F）：お気に入りポップアップを開く
- コールバックサポート付きイベントハンドラー
- アプリ終了時の適切なクリーンアップ

### UI/UXの詳細
- NSPopoverとPopupWindowの両方をサポート
- メニューバーからポップオーバー表示
- ホットキーでフローティングウィンドウ表示
- 透明な背景（95%不透明度）で統一感のあるデザイン
- 履歴とお気に入りタブの切り替え
- プロフェッショナルなクリップボードアイコン

## 🎯 使用例

### 基本的な使い方
1. 通常通りテキストや画像をコピー
2. ⌥⌘V を押してClipPilot履歴を開く
3. ⌥⌘F を押してお気に入りを開く
4. 履歴を検索または参照
5. アイテムをクリックしてペースト

### 高度な機能
- **アイテムをピン留め**：右クリック → ピン留め
- **タブ切り替え**：履歴タブとお気に入りタブを切り替え
- **検索**：検索バーに入力
- **フィルタ**：テキスト/RTF/画像ボタンをクリック
- **クリア**：メニューバー → 履歴をクリア
- **設定**：メニューバー → 設定

### アプリの除外
1. 設定 → 除外 を開く
2. バンドル識別子を追加（例：`com.apple.keychainaccess`）
3. 一般的なパスワードマネージャー用のクイックボタン

## 🧪 テスト結果

16個のテスト全てが合格：
- ✅ テキストアイテムの追加
- ✅ 重複の抑制
- ✅ ピン留め/ピン解除の切り替え
- ✅ アイテムの削除
- ✅ 全クリア/ピン解除のみクリア
- ✅ 検索機能
- ✅ タイプ別フィルタ
- ✅ 最大長の適用
- ✅ プレビューテキストの切り詰め
- ✅ 設定管理
- ✅ 除外アプリ管理
- ✅ クリップボードアイテムの作成
- ✅ 表示テキストのフォーマット
- ✅ パフォーマンスベンチマーク

パフォーマンス指標：
- 100アイテム追加：平均約0.063秒
- 500アイテム検索：平均約0.002秒

## 🌐 ローカライズ

### サポート言語
1. **英語（en）** - デフォルト
2. **日本語（ja）**

### 新しい言語の追加
1. ディレクトリを作成：`Sources/Resources/[lang].lproj/`
2. コピーして翻訳：`Localizable.strings`
3. 必要に応じて`Package.swift`を更新

## 🔧 設定

### Constants.swift
```swift
pollingInterval: 0.3s           // クリップボードチェック頻度
defaultMaxHistoryItems: 500     // 最大保存アイテム数
defaultMaxHistoryDays: 30       // アイテム保持日数
defaultMaxTextLength: 10000     // 文字数制限
defaultMaxImageSizeKB: 5000     // 画像サイズ制限
thumbnailSize: 64px             // プレビューサムネイルサイズ
```

### 設定（ランタイム）
- 全ての設定を設定ウィンドウで調整可能
- UserDefaultsに保存
- 即座に反映（再起動不要）

## 🐛 既知の制限事項

1. **アクセシビリティ必須**：ペースト機能にアクセシビリティ権限が必要
2. **ポーリングベース**：プッシュ通知ではなくポーリング（300ms）を使用
3. **合成イベント**：一部のアプリがCGEventベースのペーストをブロックする可能性
4. **RTFはテキストのみ**：RTFはプレビューでプレーンテキストとして表示

## 🔒 プライバシーとセキュリティ

### データストレージ
- 全データはCore Dataでローカルに保存
- 保存場所：`~/Library/Application Support/ClipPilot/`
- ネットワークアクセスなし
- テレメトリーなし

### 推奨される除外設定
- パスワードマネージャー：1Password、LastPass、Bitwarden
- 銀行アプリ
- キーチェーンアクセス
- 機密情報を扱う全てのアプリ

## 📚 技術スタック

- **言語**：Swift 5.9以降
- **UIフレームワーク**：SwiftUI + AppKit
- **ストレージ**：Core Data
- **ホットキー**：Carbon Event Manager
- **ペースト**：CGEvent API
- **ビルドシステム**：Swift Package Manager
- **テスト**：XCTest
- **最小macOS**：13.0（Ventura）

## 🎉 プロジェクトステータス

**✅ 完成し、使用可能**

全ての要件を満たしています：
- ✅ 監視機能付きメニューバーアプリ
- ✅ グローバルホットキー（⌥⌘V）
- ✅ 検索、フィルタ、ピン留め機能
- ✅ テキスト/RTF/画像サポート
- ✅ Core Dataストレージ
- ✅ アクセシビリティベースのペースト
- ✅ 全設定を含む設定画面
- ✅ アプリ除外リスト
- ✅ 日本語/英語ローカライズ
- ✅ 包括的なテスト
- ✅ 完全なドキュメント

## 🚢 次のステップ

### すぐに使う場合
1. ビルド：`cd ClipPilot && swift build`
2. 実行：`swift run` またはXcodeで開く
3. アクセシビリティ権限を付与
4. 使い始める！

### 配布用DMGの作成
1. アイコンを生成：`./scripts/create-icons.sh`
2. DMGをビルド：`./scripts/build-dmg.sh`
3. 生成されたDMGをテスト：`ClipPilot-1.0.3.dmg`
4. GitHub Releasesでリリース
5. オプション：Developer IDで署名して公証

### オプションの機能拡張
- iCloud同期（CloudKit）
- 画像のOCR（Vision）
- 正規表現変換
- スニペットテンプレート
- カスタマイズ可能なホットキーUI
- リッチテキストプレビュー

## 📖 さらに詳しく

- **README.md**：完全なユーザードキュメント
- **BUILDING.md**：詳細なビルド手順
- **ソースコード**：適切にコメント化され整理されています
- **テスト**：使用例はClipPilotTests.swiftを参照

## 💡 ヒント

1. **初回起動**：アクセシビリティ権限をすぐに付与
2. **パフォーマンス**：必要に応じてポーリング間隔を調整
3. **プライバシー**：機密アプリを除外リストに追加
4. **ストレージ**：ピン留めアイテムは期限切れになりません
5. **検索**：大文字小文字を区別せず、部分一致
6. **ホットキー**：他のアプリと競合する場合はシステム環境設定を確認

## 🙏 クレジット

- SwiftとSwiftUIで構築
- ネイティブmacOSフレームワークを使用
- サードパーティ依存関係なし
- オープンソース（MITライセンス）

---

**ClipPilotをご利用いただきありがとうございます！🚀**

問題や質問がある場合は、README.mdを参照するか、issueを開いてください。
